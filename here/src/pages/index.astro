---
import SalaryCalculator from '../components/Calculator.jsx';
---

<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Salary Calculator</title>
  </head>
  <body>
    <header style="display:flex;justify-content:space-between;align-items:center;max-width:900px;margin:0 auto;padding:1rem;">
      <h1>Calcolatore RAL ‚Üí Netto</h1>
      <button aria-label="Toggle dark mode" style="padding:8px 12px;border:1px solid var(--border);background:var(--card);border-radius:6px;cursor:pointer;font-size:1.2rem;">
        üåô
      </button>
    </header>
    <main style="max-width:900px;margin:2rem auto;padding:1rem;">
      <p style="color:var(--text);">Inserisci la RAL (Retribuzione Annua Lorda) e clicca "Calcola".</p>

      <SalaryCalculator client:load />

      <hr style="margin:2rem 0" />

    </main>

    <!-- Dark mode toggle script -->
    <script>
    (function(){
      function initThemeToggle() {
        try {
          const stored = localStorage.getItem('theme');
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const root = document.documentElement;

          function apply(theme) {
            if (theme === 'dark') root.classList.add('dark');
            else root.classList.remove('dark');
          }

          const initial = stored || (prefersDark ? 'dark' : 'light');
          apply(initial);
          console.log('[theme] initialized:', initial);

          Object.defineProperty(window, 'toggleTheme', {
            value: function() {
              const isDark = root.classList.toggle('dark');
              localStorage.setItem('theme', isDark ? 'dark' : 'light');
              console.log('[theme] toggled, now dark=', isDark);
              return isDark;
            },
            writable: true
          });

          // Also attach listener directly to the button to avoid timing/inline onclick issues
          const btn = document.querySelector('[aria-label="Toggle dark mode"]');
          if (btn) {
            // set initial pressed state and icon
            const isDark = initial === 'dark';
            btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
            btn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            btn.addEventListener('click', (e) => {
              e.preventDefault();
              const nowDark = window.toggleTheme();
              btn.setAttribute('aria-pressed', nowDark ? 'true' : 'false');
              btn.textContent = nowDark ? '‚òÄÔ∏è' : 'üåô';
            });
          } else {
            console.warn('[theme] toggle button not found');
          }
        } catch (err) {
          console.error('[theme] init error', err);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initThemeToggle);
      } else {
        initThemeToggle();
      }
    })();
    </script>
  </body>
</html>